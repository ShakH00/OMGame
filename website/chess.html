<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <link rel="stylesheet" href="all.css">
    <link rel="stylesheet" href="chess.css">
    <title>Chess Promotion and Capture Tutorial</title>
</head>
<body>
    <div class="header">
        <div class="header-left"><a href="index.html"><img style="height: auto; width: 35px" src="assets/tetrisCatIcon.png"/></a></div>
        <div class="header-center">
            <a href="index.html">Home</a>
            <a href="help.html">Help</a>
            <a href="store.html">Store</a>
        </div>
        <div class="header-right">
            <a href="#" class="signup-btn">Sign up</a>
            <a href="#" class="login-btn">Login</a>
        </div>
    </div>

    <h1>Chess Promotion and Capture Tutorial</h1>
    <div class="board" id="board"></div>
    <button class="button" onclick="resetBoard()">Reset Board</button>

    <div class="overlay" id="CHoverlay" onclick="closePopup()"></div>
    <div class="container" id="CHpopupBox">
        <img class="popup-tetriscat" style="height: 150px; width: auto; left: 385px; top: -120px;" src="assets/tetrisCat1.GIF" alt=""/>
        <div class="contact-box">
            <div class="sos-box">SOS!!</div>
            <button class="close-btn" onclick="closePopup()">Ã—</button>
            <p id="popup-text"></p>
        </div>
    </div>

    <script>
        const board = document.getElementById('board');
        let pawnPosition = 48;
        let enemyPosition = 9;

        function createBoard() {
            board.innerHTML = '';
            for (let i = 0; i < 64; i++) {
                const square = document.createElement('div');
                square.classList.add('square', (Math.floor(i / 8) + i % 8) % 2 === 0 ? 'light' : 'dark');
                board.appendChild(square);
            }
            placePawn();
            placeEnemy();
            showPopup(`Hi! I'm Tetris Cat. Let's learn chess! Move your pawn to promote it to a queen, then capture the enemy piece.`);
        }

        function placePawn() {
            const squares = document.querySelectorAll('.square');
            const pawn = document.createElement('img');
            pawn.classList.add('piece');
            pawn.src = 'assets/chessPawnWhite.png';
            squares[pawnPosition].appendChild(pawn);
            pawn.onclick = highlightMoves;
        }

        function placeEnemy() {
            const squares = document.querySelectorAll('.square');
            const enemy = document.createElement('img');
            enemy.classList.add('piece');
            enemy.src = 'assets/chessRookBlack.png';
            squares[enemyPosition].appendChild(enemy);
        }

        function highlightMoves() {
            clearHighlights();
            const squares = document.querySelectorAll('.square');
            const movePos = pawnPosition - 8;
            if (movePos >= 0 && squares[movePos].innerHTML === '') {
                const highlightDot = document.createElement('div');
                highlightDot.classList.add('highlight');
                squares[movePos].appendChild(highlightDot);
                highlightDot.onclick = () => movePawn(movePos);
            }

            if (pawnPosition === 16 && enemyPosition === 8) {
                const captureDot = document.createElement('div');
                captureDot.classList.add('highlight');
                squares[enemyPosition].appendChild(captureDot);
                captureDot.onclick = () => capturePiece(enemyPosition);
                showPopup('Capture the enemy rook!');
            }
        }

        function movePawn(newPos) {
            pawnPosition = newPos;
            updateBoard();
            if (pawnPosition < 8) promotePawn();
        }

        function capturePiece(newPos) {
            pawnPosition = newPos;
            enemyPosition = null;
            updateBoard();
            showPopup('Great job! You captured the enemy rook!');
        }

        function promotePawn() {
            const squares = document.querySelectorAll('.square');
            squares[pawnPosition].innerHTML = '';
            const queen = document.createElement('img');
            queen.classList.add('piece');
            queen.src = 'assets/chessQueenWhite.png';
            squares[pawnPosition].appendChild(queen);
            showPopup('Excellent! Your pawn is now a queen! Now, capture the enemy rook.');
        }

        function updateBoard() {
            document.querySelectorAll('.square').forEach(sq => sq.innerHTML = '');
            placePawn();
            if (enemyPosition !== null) placeEnemy();
        }

        function clearHighlights() {
            document.querySelectorAll('.highlight').forEach(dot => dot.remove());
        }

        function resetBoard() {
            pawnPosition = 48;
            enemyPosition = 8;
            createBoard();
        }

        function showPopup(text) {
            document.getElementById('popup-text').innerHTML = text;
            document.getElementById('CHoverlay').classList.add("show");
            document.getElementById('CHpopupBox').classList.add("show");
        }

        function closePopup() {
            document.getElementById('CHoverlay').classList.remove("show");
            document.getElementById('CHpopupBox').classList.remove("show");
        }

        createBoard();
    </script>
</body>
</html>